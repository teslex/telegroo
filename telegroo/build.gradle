plugins {
	id 'groovy'

	id 'maven-publish'
	id 'com.github.johnrengelman.shadow' version '4.0.4'
}

dependencies {
	shadow project(':api')

	compile group: 'org.codehaus.groovy', name: 'groovy', version: groovyVersion
	compile group: 'org.codehaus.groovy', name: 'groovy-json', version: groovyVersion

	compile group: 'org.apache.httpcomponents', name: 'httpcore', version: apacheHttpCoreVersion
	compile group: 'org.apache.httpcomponents', name: 'httpclient', version: apacheHttpClientVersion
	compile group: 'org.apache.httpcomponents', name: 'fluent-hc', version: apacheHttpFluentHcVersion
	compile group: 'org.apache.httpcomponents', name: 'httpmime', version: apacheHttpHttpMimeVersion

	testCompile 'org.spockframework.spock:spock-core:spock-1.2'
}

jar {

}

shadowJar {
	configurations = [project.configurations.shadow]

	dependencies {
		exclude(dependency {
			it.moduleGroup != 'tech.teslex.telegroo' &&
					it.moduleGroup != 'telegroo'
		})
	}
}

publishing {
	publications {
		maven(MavenPublication) {
			groupId 'tech.teslex.telegroo'
			artifactId 'telegroo'
			version version

			from components.java
			artifact shadowJar
		}
	}

	repositories {
		maven {
			def releasesRepoUrl = "$buildDir/repo"
			def snapshotsRepoUrl = "$buildDir/repo/snapshots"
			url = version.endsWith('SNAPSHOT') ? snapshotsRepoUrl : releasesRepoUrl

		}
	}
}
